<!-- permanent ID of this item: {{{thing.id}}} -->
<h1 class="grid-adjacent">
{{{getThingLabel thing}}}{{>sync_info thing=thing sync=thing.sync.label editable=true field="label"}}
</h1>
{{#if (mlSafeText thing.subtitle)}}
<h2 class="subtitle">{{mlSafeText thing.subtitle}}{{>sync_info thing=thing sync=thing.sync.subtitle editable=false}}</h2>
{{/if}}
<div class="grid grid-with-sidebar">
{{! LEFT COLUMN: REVIEWS}}
<div>
{{#if userReviews}}
<h2 id="your-review">{{{__ "your review"}}}</h2>
{{>feed thingFeed=true feedItems=userReviews paginationURL=false highlightFirstReview=true}}
{{/if}}
{{#if otherReviews}}
<h2>{{#if userReviews}}{{{__ "other reviews"}}}{{else}}{{{__ "reviews"}}}{{/if}}</h2>
{{#if hasMoreThanOneReview}}
<div class="review-metrics">
{{{__ "review metrics" (__n "one or multiple stars" (round thing.averageStarRating 1)) (__n "one or multiple reviews" thing.numberOfReviews)}}}
</div>
{{/if}}
{{#if user}}
{{#unless userReviews}}
<p><a href="/new/review/{{{thing.urlID}}}" id="add-review" role="button" class="button-compact secondary no-print"><span class="fa fa-fw fa-pencil spaced-icon"></span> {{{__ "add your review"}}}</a></p>
{{/unless}}
{{else}}
<p><b>{{{__ "sign in to review"}}}</b></p>
{{/if}}
{{>feed thingFeed=true feedItems=otherReviews}}
{{/if}}
</div>
{{! /LEFT COLUMN}}
{{! RIGHT COLUMN: THING METADATA}}
<div>
<div class="thing-info">
<h2>{{{__ "thing about heading"}}}</h2>
<ul class="fa-ul thing-data-list">
{{#if thing.urls}}
<li class="thing-data-list-item"><div class="thing-url-container">
<span class="fa fa-li fa-external-link thing-data-icon"></span>
<span class="thing-data-primary thing-data-url-primary">{{{link thing.urls.[0] (prettify thing.urls.[0])}}}</span>
</div>
{{!Additional URLs beyond the primary URL are presented in a compact table, categorized:}}
{{#if taggedURLs}}
<table class="thing-data-urls-table">
{{#each taggedURLs}}
<tr>
<td class="thing-data-urls-table-tag">{{{__ (getTagMsgKey @key)}}}</td>
<td>
{{#each (lookup ../taggedURLs @key)}}
{{#ifCond this.id '==' 'unknown'}}
<span class="thing-data-urls-table-link">{{{link this.url (prettify this.url)}}}</span>
{{else}}
<span class="thing-data-urls-table-link"><a href="{{{this.url}}}">{{{__ (getSourceMsgKey this.id)}}}</a></span>
{{/ifCond}}
{{/each}}
</td>
</tr>
{{/each}}
</table>
{{/if}}
{{#if thing.userCanEdit}}<a href="/{{{thing.urlID}}}/manage/urls" id="manage-urls" role="button" class="button-compact secondary no-print"><span class="fa fa-fw fa-cogs spaced-icon"></span> {{{__ "manage links"}}}</a>{{/if}}
</li>
{{/if}}
{{#ifCond (mlSafeText thing.description) '||' thing.userCanEdit}}
<li class="thing-data-list-item"><span class="fa fa-li fa-info-circle thing-data-icon"></span>
<span class="thing-data-primary">
{{#if (mlSafeText thing.description)}}
{{! The powertip is shown for JS users, and includes a clickable link to the source from which the data was synced.}}
{{mlSafeText thing.description}}{{>sync_info thing=thing field="description" sync=thing.sync.description editable=true}}
{{else}}
{{#if thing.userCanEdit}}
<a href="/{{{thing.urlID}}}/edit/description" id="add-description" role="button" class="button-compact secondary no-print"><span class="fa fa-fw fa-pencil spaced-icon"></span> {{{__ "add description"}}}</a>
{{/if}}
{{/if}}
</span>
</li>
{{/ifCond}}
{{#if thing.authors}}
<li class="thing-data-list-item">
<span class="fa fa-li fa-user thing-data-icon"></span>
<span class="thing-data-primary">
{{#each thing.authors}}
{{mlSafeText this false}}{{#unless @last}}, {{/unless}}
{{/each}}
{{>sync_info thing=thing sync=thing.sync.authors}}
</span>
</li>
{{/if}}

{{#if thing.files}}
{{>uploads}}
{{/if}}
</ul>
{{#unless hideDeleteButton}}
{{#if thing.userCanDelete}}
{{#ifCond thing.numberOfReviews "===" 0}}
<p><form action="/{{{thing.urlID}}}/delete" method="get" style="display: inline;">
<button type="submit" id="delete-thing" class="button-destructive no-print"><span class="fa fa-fw fa-trash spaced-icon"></span> {{{__ "delete thing"}}}</button>
</form></p>
{{/ifCond}}
{{/if}}
{{/unless}}
{{#if thing.userCanUpload}}
{{>upload_form}}
{{/if}}
{{#if activeSourceIDs}}
<div class="source-licenses">
{{{__ "source data licensing"}}}<br>
{{#each activeSourceIDs}}
{{{__ (getSourceLicensingKey @this)}}}<br>
{{/each}}
{{{__ "data gratitude"}}}
</div>
{{/if}}
</div>
</div>
{{! /RIGHT COLUMN}}
</div>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{mlSafeText thing.label false}}",
  "description": "{{mlSafeText thing.description false}}",
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{{{round thing.averageStarRating 1}}}",
    "reviewCount": "{{{thing.numberOfReviews}}}"
  }
}
</script>
